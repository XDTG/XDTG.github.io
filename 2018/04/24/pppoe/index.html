<!DOCTYPE HTML>
<html>

<head><meta name="generator" content="Hexo 3.8.0">
	<link rel="bookmark" type="image/x-icon" href="/img/logo_miccall.png">
	<link rel="shortcut icon" href="/img/logo_miccall.png">
	
			    <title>
    C1ick's blog
    </title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <link rel="stylesheet" href="/css/mic_main.css">
    <link rel="stylesheet" href="/css/dropdownMenu.css">
    <meta name="keywords" content="miccall">
    
    	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	 
    <noscript>
        <link rel="stylesheet" href="/css/noscript.css">
    </noscript>
    <style type="text/css">
        body:before {
          content: ' ';
          position: fixed;
          top: 0;
          background: url('/img/bg2.jpg') center 0 no-repeat;
          right: 0;
          bottom: 0;
          left: 0;
          background-size: cover; 
        }
    </style>

			    
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script async type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.scrollex.min.js"></script>
    <script src="/js/jquery.scrolly.min.js"></script>
    <script src="/js/skel.min.js"></script>
    <script src="/js/util.js"></script>
    <script src="/js/main.js"></script>
	
</head>
    
		
<!-- Layouts -->



<!--  代码渲染  -->
<link rel="stylesheet" href="/css/prism_coy.css">
<link rel="stylesheet" href="/css/typo.css">
<!-- 文章页 -->
<body class="is-loading">
    <!-- Wrapper 外包 s-->
    <div id="wrapper" class="fade-in">
        <!-- Intro 头部显示 s -->
        <!-- Intro 头部显示 e -->
        <!-- Header 头部logo start -->
        <header id="header">
    <a href="/" class="logo">c1ick</a>
</header>
        <!-- Nav 导航条 start -->
        <nav id="nav" class="special">
            <ul class="menu links">
			<!-- Homepage  主页  --> 
			<li>
	            <a href="/" rel="nofollow">主页</a>
	        </li>
			<!-- categories_name  分类   --> 
	        
	        <li class="active">
	            <a href="#s1">分类</a>
	                    <ul class="submenu">
	                        <li>
	                        <a class="category-link" href="/categories/TCP-IP/">TCP/IP</a></li><li><a class="category-link" href="/categories/life/">life</a></li><li><a class="category-link" href="/categories/扫描工具/">扫描工具</a></li><li><a class="category-link" href="/categories/无线安全/">无线安全</a>
	                    </li></ul>
	        </li>
	        
	        <!-- archives  归档   --> 
	        
	        <li class="active">
	            <a href="#s1">归档</a>
	                    <ul class="submenu">
	                        <li>
	                        <a class="archive-link" href="/archives/2018/11/">November 2018</a></li><li><a class="archive-link" href="/archives/2018/05/">May 2018</a></li><li><a class="archive-link" href="/archives/2018/04/">April 2018</a></li><li><a class="archive-link" href="/archives/2018/03/">March 2018</a>
	                    </li></ul>
	        </li>
	        
	        
		        <!-- Pages 自定义   -->
		        
		        <li>
		            <a href="/about/" title="简历">
		                简历
		            </a>
		        </li>
		        
		        <li>
		            <a href="/group/" title="团队">
		                团队
		            </a>
		        </li>
		        
		        <li>
		            <a href="/gallery/" title="图库">
		                图库
		            </a>
		        </li>
		        
		        <li>
		            <a href="/tag/" title="标签">
		                标签
		            </a>
		        </li>
		        


            </ul>
            <!-- icons 图标   -->
			<ul class="icons">
		            
		                <li><a href="https://github.com/xdtg" class="icon fa-github"><span class="label">GitHub</span></a></li>
		            
		            
		            
		            
			</ul>
</nav>

        <div id="main">
            <div class="post_page_title_img" style="height: 25rem;background-image: url(https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1524569190162&amp;di=d19c1f1bdf7d27cb6f22801253910241&amp;imgtype=0&amp;src=http%3A%2F%2Fimgsrc.baidu.com%2Fimgad%2Fpic%2Fitem%2Fd53f8794a4c27d1ea5b35ef910d5ad6eddc43871.jpg);background-position: center; background-repeat:no-repeat; background-size:cover;-moz-background-size:cover;overflow:hidden;">
                <a href="#" style="padding: 4rem 4rem 2rem 4rem ;"><h2>利用PPPoE漏洞静默进入路由器后台</h2></a>
            </div>
            <!-- Post -->
            <div class="typo" style="padding: 3rem;">
                <h3 id="0x00"><a href="#0x00" class="headerlink" title="0x00"></a>0x00</h3><p><del>在上次组会上学长演示了ARP欺骗和DNS劫持。突然想到路由器里有一个设置是使用指定DNS服务器，如果我们进入路由器后台，修改DNS…….</del></p>
<p>通常我们只能拿到wifi的连接密码和ssid，但要进入路由器管理界面还需要管理员密码。如果路由器采取拨号联网，我们在知道拨号帐号密码后可以重置路由器来实现进入路由器后台。</p>
<p><del>这几天在freebuf上看到利用PPPoE漏洞进入路由器后台，现在对家里的路由器进行一次探索</del></p>
<h3 id="0x01-攻击原理"><a href="#0x01-攻击原理" class="headerlink" title="0x01 攻击原理"></a>0x01 攻击原理</h3><p>pppoe协议的工作流程包含两个阶段：</p>
<ul>
<li><p>发现阶段</p>
</li>
<li><p>会话阶段</p>
</li>
</ul>
<p><img src="http://image.3001.net/images/20180226/15196412033371.png" alt=""><br><img src="http://image.3001.net/images/20180226/15196412167364.png" alt=""></p>
<p>在发现阶段，客户端将PADI广播寻找PPPoE服务器，通过自建PPPoE服务器接受PADI请求与客户端建立会话。在会话阶段，通过LCP协商要求使用PAP（明文传输的认证方式），之后用wireshark等抓包工具抓包即可得到PPPoE帐号及密码。</p>
<h3 id="0x02-应用场景"><a href="#0x02-应用场景" class="headerlink" title="0x02 应用场景"></a>0x02 应用场景</h3><p>目前拨号连接广泛应用于运营商提供的网络接入，学校，小区,<em>宿舍</em>等。所以很多路由器的WAN接入方式为拨号连接，在宾馆，酒店，学校，民宿我们常常能够接触到许多无线路由器，当我们使用这些路由器的WiFi/LAN时，我们有可能已经被监听或钓鱼了。</p>
<h3 id="0x03-攻击条件"><a href="#0x03-攻击条件" class="headerlink" title="0x03 攻击条件"></a>0x03 攻击条件</h3><p>能够物理接触到路由器，WiFi密码（可以用aircreak-ng套件爆破），伪造的PPPoE服务器，kali</p>
<h3 id="0x04-攻击过程"><a href="#0x04-攻击过程" class="headerlink" title="0x04 攻击过程"></a>0x04 攻击过程</h3><h4 id="kali配置本地pppoe服务器"><a href="#kali配置本地pppoe服务器" class="headerlink" title="kali配置本地pppoe服务器"></a>kali配置本地pppoe服务器</h4><p><em>注：因为我们只需要本地pppoe服务器与路由器完成发现阶段和会话阶段的认证，所以不需要配置网络层参数。</em></p>
<p><strong>安装软件</strong></p>
<blockquote>
<p>sudo apt-get install pppoe pppoeconf</p>
</blockquote>
<p><strong>配置文件</strong></p>
<blockquote>
<p>/etc/ppp/options<br>去掉 <em>+pap</em> 的注释（使用pap明文认证）<br>/etc/ppp/pppoe-server-options （没有的话新建一个）<br>增加:<br>#auth  #注释掉这三行使用任意帐号就可以登录<br>require-pap<br>#require-chap<br>login<br>lcp-echo-interval 30<br>lcp-echo-failure 4<br>ms-dns  202.118.224.101 </p>
</blockquote>
<p><strong>运行</strong></p>
<p>modprobe pppoe<br>pppoe-server -i eth0 -N 20 -L 192.168.0.1 -R 192.168.0.100</p>
<pre><code>I：指定响应PPPOE请求的网卡，现在使用的eth0 （本机以太网卡）

L：PPPOE服务器的IP地址，客户端连接可以看到的服务器地址

R：这是分配给客户端的地址池起始地址，本例中从192.168.0.100开始

N：地址池的IP地址递增几个，本例中添增10，也就是从192.168.0.100开始分配，一共分配20个IP地址
</code></pre><p>现在自建PPPoE服务器已经开始工作了</p>
<p><em>关闭路由器电源，将路由器与本机用网线连接，打开wireshark监听eth0网卡过滤PPP协议数据包，接通路由器电源，直到抓到PPP认证数据包，如图</em></p>
<p><img src="http://wx2.sinaimg.cn/mw690/0060lm7Tly1fqwwhkzdp7j311y0lctcv.jpg" alt=""><br>~~ 这是在家做的 ~~</p>
<p><strong>进入路由器后台</strong></p>
<p>按下路由器reset，配置好拨号连接，将无线ssid和密码修改成与原来的一致，这样就很难发现路由器已被重置，达到“静默”的目的。</p>
<p>现在我们就拿到了路由器的管理权限，并且很难被发现。我们可以修改路由器的DNS服务器地址，实现对局域网内的DNS欺骗，甚至可以使用远程web管理对路由器远程控制。</p>

            </div>

            <!-- Post Comments -->
            
    <!-- 使用 DISQUS_CLICK -->
<div id="disqus-comment">
    <div id="disqus_thread"></div>

<!-- add animation -->
<style>
	.disqus_click_btn {
            line-height: 30px;
            margin: 0;
            min-width: 50px;
            padding: 0 14px;
            display: inline-block;
            font-family: "Roboto", "Helvetica", "Arial", sans-serif;
            font-size: 14px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0;
            overflow: hidden;
            will-change: box-shadow;
            transition: box-shadow .2s cubic-bezier(.4, 0, 1, 1), background-color .2s cubic-bezier(.4, 0, .2, 1), color .2s cubic-bezier(.4, 0, .2, 1);
            outline: 0;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            vertical-align: middle;
            border: 0;
            background: rgba(158, 158, 158, .2);
            box-shadow: 0 2px 2px 0 rgba(0, 0, 0, .14), 0 3px 1px -2px rgba(0, 0, 0, .2), 0 1px 5px 0 rgba(0, 0, 0, .12);
            color: #fff;
            background-color: #7EC0EE;
            text-shadow: 0
        }
</style>
	
<div class="btn_click_load" id="disqus_bt"> 
    <button class="disqus_click_btn">点击查看评论</button>
</div>

<!--
<script type="text/javascript">
$('.btn_click_load').click(function() {
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'http-miccall-tech'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    document.getElementById('disqus_bt').style.display = "none";
});
</script>
-->
<script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'http://yoursite.com/2018/04/24/pppoe/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'http://yoursite.com/2018/04/24/pppoe/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
</script>

<script type="text/javascript">
    $('.btn_click_load').click(function() {  //click to load comments
        (function() { // DON'T EDIT BELOW THIS LINE
            var d = document;
            var s = d.createElement('script');
            s.src = '//http-miccall-tech.disqus.com/embed.js';
            s.setAttribute('data-timestamp', + new Date());
            (d.head || d.body).appendChild(s);
        })();
        $('.btn_click_load').css('display','none');
    });
</script>
</div>
<style>
    #disqus-comment{
        background-color: #eee;
        padding: 2pc;
    }
</style>


        </div>
        <!-- Copyright 版权 start -->
                <div id="copyright">
            <ul>
                <li>&copy;Powered By <a href="https://hexo.io/zh-cn/" style="border-bottom: none;">hexo</a></li>
                <li>Design: <a href="http://miccall.tech " style="border-bottom: none;">miccall</a></li>
            </ul>
            
            	<span id="busuanzi_container_site_pv">2018总访问量<span id="busuanzi_value_site_pv"></span>次</span>
			
        </div>
    </div>
</body>



 	
</html>
